# TLS-CRYPTO-GOST-VPN-PROTO
TLS-CRYPTO-GOST-VPN-PROTO ‚Äî –ø—Ä–æ—Ç–æ—Ç–∏–ø –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ C++ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OpenSSL –∏ –ì–û–°–¢-–∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —á–µ—Ä–µ–∑ –¥–≤–∏–∂–æ–∫ `gost-engine`. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∑–∞—â–∏—â—ë–Ω–Ω–æ–µ TLS-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ (–ú–∞–≥–º–∞, –ö—É–∑–Ω–µ—á–∏–∫) –∏ –ø—Ä–æ–∫—Å–∏-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤.

## –û–ø–∏—Å–∞–Ω–∏–µ
- **Server**: TLS-—Å–µ—Ä–≤–µ—Ä, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–π –∏—Ö –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Ö–æ—Å—Ç (–ø–æ—Ä—Ç 80) –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ TLS.
- **Client**: TLS-–∫–ª–∏–µ–Ω—Ç, –¥–µ–π—Å—Ç–≤—É—é—â–∏–π –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω—ã–π HTTP-–ø—Ä–æ–∫—Å–∏ (—Å–ª—É—à–∞–µ—Ç –Ω–∞ `localhost:8080`), –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∏–π –∑–∞–ø—Ä–æ—Å—ã —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ TLS –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π –æ—Ç–≤–µ—Ç—ã –±—Ä–∞—É–∑–µ—Ä—É.
- **GostCipher**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `ICipherStrategy` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ TLS —Å –ì–û–°–¢-–∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ —á–µ—Ä–µ–∑ OpenSSL ENGINE.
- **FileKeyStore**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `IKeyStore` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –∫–ª—é—á–µ–π –∏–∑ PEM-—Ñ–∞–π–ª–æ–≤.
- **EngineLoader**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `IEngineLoader` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–≤–∏–∂–∫–∞ `gost-engine`.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ `ICipherStrategy` –∏ `IKeyStore`, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â –∫–ª—é—á–µ–π.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ì–û–°–¢-—à–∏—Ñ—Ä–æ–≤ (–ú–∞–≥–º–∞, –ö—É–∑–Ω–µ—á–∏–∫ –∏ –¥—Ä.) —á–µ—Ä–µ–∑ `gost-engine`.
- –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —à–∏—Ñ—Ä–∞ –∏–ª–∏ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö (`--cipher any`).
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É: —Ö–æ—Å—Ç, –ø–æ—Ä—Ç, —à–∏—Ñ—Ä, –ø—É—Ç–∏ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –∏ –∫–ª—é—á—É.
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ TLS-handshake –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–≥–æ —à–∏—Ñ—Ä–∞.
- –ü—Ä–æ–∫—Å–∏-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ TLS, —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –Ω–∞ —Ü–µ–ª–µ–≤—ã–µ —Ö–æ—Å—Ç—ã.
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-Forwarded-For` —Å IP –∫–ª–∏–µ–Ω—Ç–∞.
- RAII-–ø–æ–¥—Ö–æ–¥ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ä–µ—Å—É—Ä—Å–∞–º–∏ OpenSSL –∏ –±–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫.

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
tls-crypto-gost-vpn-proto/
‚îú‚îÄ‚îÄ include/               # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ crypto/            # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –∫–ª–∞—Å—Å—ã –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (GostCipher)
‚îÇ   ‚îú‚îÄ‚îÄ engine/            # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –∑–∞–≥—Ä—É–∑–∫–∞ OpenSSL ENGINE
‚îÇ   ‚îú‚îÄ‚îÄ net/               # –ö–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ storage/           # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫–ª—é—á–µ–π
‚îú‚îÄ‚îÄ src/                   # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ main_client.cpp    # –ó–∞–ø—É—Å–∫ TLS-–∫–ª–∏–µ–Ω—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ main_server.cpp    # –ó–∞–ø—É—Å–∫ TLS-—Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ crypto/            # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ì–û–°–¢-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ engine/            # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–≤–∏–∂–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ net/               # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ storage/           # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫–ª—é—á–µ–π
‚îú‚îÄ‚îÄ certs/                 # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –∫–ª—é—á–∏ (PEM)
‚îÇ   ‚îú‚îÄ‚îÄ cert.pem           # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ key.pem            # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
‚îú‚îÄ‚îÄ CMakeLists.txt         # –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ —á–µ—Ä–µ–∑ CMake
‚îú‚îÄ‚îÄ Dockerfile             # Docker-–æ–±—Ä–∞–∑ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚îú‚îÄ‚îÄ func_test.log          # –ª–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞
```

## üîß –°–±–æ—Ä–∫–∞ –≤—Ä—É—á–Ω—É—é (–±–µ–∑ Docker)
### üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- CMake 3.10+
- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä C++11 (GCC, Clang)
- OpenSSL —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º `gost-engine`
- Linux (POSIX sockets)

### üîë –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ì–û–°–¢-–∫–ª—é—á–∞ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```bash
openssl genpkey -engine gost -algorithm GOST2012_256 -pkeyopt paramset:A -out certs/key.pem
openssl req -engine gost -new -x509 -key certs/key.pem -out certs/cert.pem -days 365 -subj "/CN=localhost"
```

### üì¶ –°–±–æ—Ä–∫–∞
```bash
mkdir build
cd build
cmake ..
make
```

### üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫
- –í –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ ```./build/server --port 4433 --cert certs/cert.pem --key certs/key.pem```
- –í –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ ```./build/client --host 127.0.0.1 --port 4433 --cipher GOST2012-KUZNYECHIK-KUZNYECHIKOMAC```
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ proxy –Ω–∞ localhost:8080
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ example.com

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
#### –°–µ—Ä–≤–µ—Ä
```bash
$ ./build/server --port 4433
Starting server on port 4433 with cipher 'any'
Configuring GOST cipher list: GOST2012-MAGMA-MAGMAOMAC:GOST2012-KUZNYECHIK-KUZNYECHIKOMAC:...
Server listening on port 4433...
Negotiated cipher: GOST2012-KUZNYECHIK-KUZNYECHIKOMAC
[Server] Received encrypted HTTP request from client (123 bytes over TLS)
[Server] Decrypted HTTP request from client: GET / HTTP/1.1...
[Server] Connecting to target host: example.com
[Server] Sending HTTP request to target server (143 bytes, not encrypted)
[Server] Received HTTP response from target server (2048 bytes, not encrypted)
[Server] Sending encrypted response to client (2048 bytes over TLS)
```
#### –ö–ª–∏–µ–Ω—Ç
```bash
$ ./build/client --host 127.0.0.1 --port 4433 --cipher GOST2012-KUZNYECHIK-KUZNYECHIKOMAC
Starting client to 127.0.0.1:4433 with cipher 'GOST2012-KUZNYECHIK-KUZNYECHIKOMAC'
Configuring GOST cipher list: GOST2012-KUZNYECHIK-KUZNYECHIKOMAC
Negotiated cipher: GOST2012-KUZNYECHIK-KUZNYECHIKOMAC
Client listening on localhost:8080 for HTTP requests...
[Client] Received HTTP request from browser: GET / HTTP/1.1...
[Client] Sending encrypted packet to server (123 bytes over TLS)
[Client] Waiting for encrypted response from server...
[Client] Received encrypted response from server (2048 bytes over TLS)
[Client] Decrypted response from server: HTTP/1.1 200 OK...
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ GOST cipher-suite
- GOST2012-MAGMA-MAGMAOMAC
- GOST2012-KUZNYECHIK-KUZNYECHIKOMAC
- LEGACY-GOST2012-GOST8912-GOST8912
- IANA-GOST2012-GOST8912-GOST8912
- GOST2001-GOST89-GOST89

–ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤ GostCipher::supportedSuites().

## üê≥ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤ Docker (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...)
### üî® –°–±–æ—Ä–∫–∞ + –∑–∞–ø—É—Å–∫
```bash
docker-compose up --build
```

## üõ† –ü–∞—Ç—á–∏–Ω–≥
### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- TLS-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ì–û–°–¢-–∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ —á–µ—Ä–µ–∑ gost-engine.
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ ICipherStrategy –∏ IKeyStore.
- HTTP-–ø—Ä–æ–∫—Å–∏ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ TLS.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ X-Forwarded-For.
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ OpenSSL.

### üí° –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è VPN-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (—Ç—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞).
- –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ (–Ω–µ —Ç–æ–ª—å–∫–æ HTTP).
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫–ª—é—á–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (DbKeyStore).
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –∫–ª—é—á–µ–π.
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ cipher-suite.
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ GUI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º.


## –û—à–∏–±–∫–∏ –∏ —Ñ–∏–∫—Å—ã
### 1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞ openssl –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ gost-engine
–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª /etc/ssl/openssl.cnf (–∏–ª–∏ —Å–º–æ—Ç—Ä–∏ OPENSSL_CONF):
–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü:
```
openssl_conf = openssl_init

[openssl_init]
engines = engine_section

[engine_section]
gost = gost_section

[gost_section]
engine_id = gost
dynamic_path = /usr/lib/x86_64-linux-gnu/engines-3/gost.so
default_algorithms = ALL
```
### 2. –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ certs/cert.pem, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏–º–µ–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π PEM-—Ñ–æ—Ä–º–∞—Ç.
